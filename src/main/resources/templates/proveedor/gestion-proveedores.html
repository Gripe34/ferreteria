<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>GestiÃ³n de Proveedores</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        /* ---------------------------------------------------- */
        /* ðŸš€ PALETA Y ESTILOS GLOBALES */
        /* ---------------------------------------------------- */
        :root { 
            --brand-orange: #D97706; 
            --brand-dark: #1F2937; 
            --color-inactivo: #e9ecef; /* Fondo gris claro para inactivos */
            --color-inactivo-text: #6c757d; /* Texto gris oscuro para inactivos */
            --color-success: #198754;
            --color-warning: #ffc107;
        }
        body { font-family: 'Roboto', sans-serif; background-color: #f4f6f8; }
        .btn-primary-custom { background-color: var(--brand-orange); border-color: var(--brand-orange); }
        .btn-primary-custom:hover { background-color: #B45309; border-color: #B45309; }
        
        .app-wrapper { display: flex; min-height: 100vh; }
        .main-content { flex-grow: 1; padding: 20px 40px; }
        .card-header-custom { background-color: var(--brand-dark) !important; color: white !important; }
        
        /* ---------------------------------------------------- */
        /* ðŸ“Š ESTILOS DE LA TABLA Y FILAS */
        /* ---------------------------------------------------- */
        .table-admin th { 
            font-weight: 700; 
            background-color: var(--brand-dark) !important; 
            color: white;
            font-size: 0.85rem;
            vertical-align: middle;
        }
        .table-admin td {
            font-size: 0.95rem;
            vertical-align: middle;
        }

        /* Estilo para fila de proveedor Bloqueado/Inactivo */
        .proveedor-inactivo {
            background-color: var(--color-inactivo) !important;
            color: var(--color-inactivo-text) !important;
            font-style: italic;
            opacity: 0.7;
            text-decoration: line-through; /* Tachado sutil para indicar inactividad */
        }
        
        /* Ajuste de botones para que queden alineados */
        .action-group {
            display: flex;
            gap: 5px;
            flex-wrap: nowrap;
        }
        .action-group .btn {
            min-width: 40px;
        }
    </style>
</head>
<body>

<div class="app-wrapper">

    <div th:replace="~{admin/fragments/sidebar :: admin-sidebar}"></div>

    <div class="main-content">
        <div class="container-fluid pt-5">

            <div th:if="${mensajeExito}" class="alert alert-success alert-dismissible fade show fw-bold shadow-sm" role="alert">
                <i class="bi bi-check-circle-fill"></i> <span th:text="${mensajeExito}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <div th:if="${errorCritico}" class="alert alert-danger alert-dismissible fade show fw-bold shadow-sm" role="alert">
                <i class="bi bi-exclamation-octagon-fill"></i> <span th:text="${errorCritico}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>


            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="display-6 fw-bold"><i class="bi bi-person-badge"></i> GestiÃ³n de Proveedores</h1>

                <a th:href="@{/gestion-proveedores/nuevo}" class="btn btn-primary-custom shadow-sm">
                    <i class="bi bi-plus-circle-fill"></i> AÃ±adir Proveedor
                </a>
            </div>

            <div class="card shadow-lg border-0"> <div class="card-header card-header-custom fw-bold"><i class="bi bi-list-stars"></i> Listado de Proveedores Registrados</div>
                <div class="card-body p-0">

                    <div th:if="${proveedores.isEmpty()}" class="alert alert-info text-center m-4">
                        AÃºn no hay proveedores registrados. Â¡AÃ±ade el primero!
                    </div>

                    <div class="table-responsive">
                        <table th:unless="${proveedores.isEmpty()}" class="table table-hover table-admin align-middle mb-0">
                            <thead class="table-dark"> 
                            <tr>
                                <th style="width: 5%;">ID</th>
                                <th style="width: 25%;">Nombre de la Empresa</th>
                                <th style="width: 20%;">Email de Contacto</th>
                                <th style="width: 10%;">TelÃ©fono</th>
                                <th style="width: 10%;">Estado</th> <th style="width: 15%;">Fecha de Registro</th>
                                <th style="width: 15%;">Acciones</th> </tr>
                            </thead>
                            <tbody>
                            <tr th:each="proveedor : ${proveedores}"
                                th:classappend="${!proveedor.activo} ? 'proveedor-inactivo' : ''"> <td th:text="${proveedor.id}">1</td>
                                <td th:text="${proveedor.nombre}" class="fw-bold">Proveedor Central S.A.</td>
                                <td th:text="${proveedor.contactoEmail}">contacto@central.com</td>
                                <td th:text="${proveedor.contactoTelefono}">+57 300 000 0000</td>
                                
                                <td>
                                    <span th:if="${proveedor.activo}" class="badge bg-success"><i class="bi bi-check-circle"></i> Activo</span>
                                    <span th:unless="${proveedor.activo}" class="badge bg-danger"><i class="bi bi-lock-fill"></i> Bloqueado</span>
                                </td>

                                <td th:text="${#temporals.format(proveedor.fechaRegistro, 'dd/MM/yyyy')}">20/01/2025</td>
                                
                                <td>
                                    <div class="action-group">
                                        
                                        <form th:action="@{/gestion-proveedores/bloquear/{id}(id=${proveedor.id})}" method="post" class="d-inline">
                                            <button type="submit" 
                                                    th:class="${proveedor.activo} ? 'btn btn-sm btn-warning shadow-sm' : 'btn btn-sm btn-success shadow-sm'"
                                                    th:title="${proveedor.activo} ? 'Bloquear Proveedor' : 'Activar Proveedor'"
                                                    th:attr="onclick=|return confirm('Â¿EstÃ¡ seguro de ${proveedor.activo ? 'BLOQUEAR' : 'ACTIVAR'} al proveedor ' + ${proveedor.nombre} + '?');|">
                                                
                                                <i th:class="${proveedor.activo} ? 'bi bi-lock-fill' : 'bi bi-unlock-fill'"></i>
                                                <span class="d-none d-lg-inline" th:text="${proveedor.activo} ? ' Bloquear' : ' Activar'"></span>
                                            </button>
                                        </form>

                                        <a th:href="@{/gestion-proveedores/editar/{id}(id=${proveedor.id})}"
                                           class="btn btn-sm btn-outline-info" title="Editar">
                                            <i class="bi bi-pencil-square"></i>
                                        </a>
                                        
                                        <form th:action="@{/gestion-proveedores/eliminar/{id}(id=${proveedor.id})}" method="post" class="d-inline" onsubmit="return confirm('Â¿EstÃ¡ seguro de eliminar este proveedor? Esta acciÃ³n es irreversible.');">
                                            <button type="submit" class="btn btn-sm btn-outline-danger" title="Eliminar">
                                                <i class="bi bi-trash3-fill"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>