<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Categorías - El Yunque de Hierro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.8/css/dataTables.bootstrap5.min.css">

    <style>
        /* BASE Y TIPOGRAFÍA */
        body { font-family: 'Poppins', sans-serif; background-color: #e9ecef; margin: 0; }
        h1, h2 { font-weight: 700; color: #212529; }

        /* BOTONES DE MARCA */
        .btn-primary-custom { background-color: #D97706; border-color: #D97706; font-weight: 600; transition: transform 0.2s; }
        .btn-primary-custom:hover { background-color: #B45309; border-color: #B45309; transform: translateY(-1px); }

        /* LAYOUT */
        .app-wrapper { display: flex; min-height: 100vh; }
        .main-content { flex-grow: 1; padding: 2.5rem 2rem; }

        /* TARJETA PRINCIPAL Y TABLA */
        .card-categorias {
            border: none;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1); /* Sombra más pronunciada */
            overflow: hidden;
        }
        .table-custom th {
            font-weight: 600;
            background-color: #343a40 !important; /* Gris oscuro para profesionalismo */
            color: #fff;
            padding: 1rem 1.5rem;
        }
        .table-custom td {
            font-size: 0.95rem;
            vertical-align: middle;
            padding: 1rem 1.5rem; /* Más padding en las celdas */
        }
        .table-custom tbody tr:hover {
            background-color: #f0f2f4; /* Resaltar suavemente */
        }

        /* ESTILO DE AUDITORÍA Y LEYENDA */
        .leyenda-auditoria {
            border-radius: 8px;
            font-weight: 400;
            border-left: 5px solid;
            font-size: 0.95rem;
        }

        /* DATA TABLES FOOTER (Para que se integre bien) */
        .dataTables_wrapper { padding: 1rem; background-color: white; border-radius: 0 0 12px 12px; }
        .dataTables_filter, .dataTables_length, .dataTables_info, .dataTables_paginate { padding: 10px 0; }
    </style>

</head>
<body>

<div class="app-wrapper">

    <div th:replace="~{admin/fragments/sidebar :: admin-sidebar}">
    </div>

    <div class="main-content">

        <div class="container-fluid pt-5">

            <div class="d-flex justify-content-between align-items-center mb-5">
                <h1 class="display-6 fw-bold"><i class="bi bi-tags-fill text-primary"></i> Gestión de Categorías</h1>

                <a th:href="@{/admin/categorias/nuevo}" class="btn btn-lg btn-primary-custom shadow-sm">
                    <i class="bi bi-plus-circle-fill"></i> Crear Nueva Categoría
                </a>
            </div>

            <div class="alert alert-warning border-start border-4 border-warning shadow-sm leyenda-auditoria mb-4" role="alert">
                <p class="mb-1 fw-bold"><i class="bi bi-lock-fill"></i> Regla de Integridad (Auditoría):</p>
                <p class="mb-0">Las categorías **no pueden ser eliminadas** si tienen productos asociados en el inventario. Asegúrese de reasignar o eliminar los productos antes de borrar la categoría.</p>
            </div>

            <div class="card card-categorias shadow-lg">
                <div class="card-body p-0">
                    <table id="categoriasTabla" class="table table-hover table-custom align-middle mb-0 w-100">
                        <thead class="table-dark">
                        <tr>
                            <th style="width: 10%;">ID</th>
                            <th style="width: 70%;">Nombre de la Categoría</th>
                            <th style="width: 20%;" class="text-center">Acciones</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="categoria : ${categorias}">
                            <td th:text="${categoria.id}">1</td>
                            <td th:text="${categoria.nombre}" class="fw-bold text-dark">Tornillería</td>
                            <td class="text-center">
                                <a th:href="@{/admin/categorias/editar/{id}(id=${categoria.id})}"
                                   class="btn btn-sm btn-outline-primary me-2" title="Editar Categoría">
                                    <i class="bi bi-pencil-square"></i> Editar
                                </a>

                                <form th:action="@{/admin/categorias/eliminar/{id}(id=${categoria.id})}"
                                      method="post" class="d-inline"
                                      onsubmit="return confirm('⚠️ ADVERTENCIA: ¿Seguro que quieres eliminar la categoría ' + [[${categoria.nombre}]] + '? Esto fallará si tiene productos.');">

                                    <button type="submit" class="btn btn-sm btn-outline-danger" title="Eliminar Categoría">
                                        <i class="bi bi-trash3-fill"></i> Eliminar
                                    </button>
                                </form>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.datatables.net/2.0.8/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/2.0.8/js/dataTables.bootstrap5.min.js"></script>

<script th:inline="none">
    $(document).ready(function() {
        // Inicializa la tabla de categorías con DataTables
        $('#categoriasTabla').DataTable({
            language: {
                // Cargamos el idioma español para DataTables
                url: '//cdn.datatables.net/plug-ins/2.0.8/i18n/es-ES.json'
            },
            responsive: true,
            // Ordena por defecto por ID de forma descendente
            order: [[0, 'desc']],
            // Oculta la paginación si hay pocos elementos
            "paging": $(this).find('tbody tr').length > 10
        });
    });
</script>
</body>
</html>